# SPDX-License-Identifier: AGPL-3.0-only
# SPDX-FileCopyrightText: 2024 Univention GmbH
---
kind: "ConfigMap"
apiVersion: "v1"
metadata:
  name: {{ printf "%s-common" (include "common.names.fullname" .) }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
    {{- if .Values.additionalLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.additionalLabels "context" . ) | nindent 4 }}
    {{- end }}
  {{- if .Values.additionalAnnotations }}
  annotations: {{- include "common.tplvalues.render" ( dict "value" .Values.additionalAnnotations "context" . ) | nindent 4 }}
  {{- end }}
data:
  {{- if .Values.nats.bundled }}
  NATS_HOST: {{ printf "%s-nats" (include "common.names.fullname" .) }}
  NATS_PORT: "4222"
  {{- else }}
  NATS_HOST: {{ required ".Values.nats.connection.host is required." .Values.nats.connection.host | quote }}
  NATS_PORT: {{ required ".Values.nats.connection.port is required." .Values.nats.connection.port | quote }}
  {{- end }}
  {{- if .Values.nats.connection.token }}
  NATS_CLIENTAUTH_TOKEN: {{ .Values.nats.connection.token | quote }}
  {{- end }}
  {{- if .Values.nats.connection.tls.enabled }}
  NATS_TLS_KEY_FILE: {{ required ".Values.nats.connection.tls.keyFile is required." .Values.nats.connection.tls.keyFile | quote }}
  NATS_TLS_CERT_FILE: {{ required ".Values.nats.connection.tls.certFile is required." .Values.nats.connection.tls.certFile | quote }}
  NATS_TLS_CA_FILE: {{ required ".Values.nats.connection.tls.caFile is required." .Values.nats.tls.caFile | quote }}
  {{- end }}
...
---
kind: "ConfigMap"
apiVersion: "v1"
metadata:
  name: {{ printf "%s-api" (include "common.names.fullname" .) }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
    {{- if .Values.additionalLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.additionalLabels "context" . ) | nindent 4 }}
    {{- end }}
  {{- if .Values.additionalAnnotations }}
  annotations: {{- include "common.tplvalues.render" ( dict "value" .Values.additionalAnnotations "context" . ) | nindent 4 }}
  {{- end }}
data:
  LOG_LEVEL: {{ required ".Values.api.config.LOG_LEVEL is required." .Values.api.config.LOG_LEVEL | quote  }}
  DEBUG: {{ required ".Values.api.config.DEBUG is required." .Values.api.config.DEBUG | quote  }}
  ROOT_PATH: {{ required ".Values.api.config.ROOT_PATH is required." .Values.api.config.ROOT_PATH | quote  }}
  CORS_ALL: {{ required ".Values.api.config.CORS_ALL is required." .Values.api.config.CORS_ALL | quote  }}
  NATS_USER: {{ required ".Values.api.config.NATS_USER is required." .Values.api.config.NATS_USER | quote  }}
  NATS_PASSWORD: {{ required ".Values.api.config.NATS_PASSWORD is required." .Values.api.config.NATS_PASSWORD | quote  }}
  ADMIN_USERNAME: {{ required ".Values.api.config.ADMIN_USERNAME is required." .Values.api.config.ADMIN_USERNAME | quote  }}
  ADMIN_PASSWORD: {{ required ".Values.api.config.ADMIN_PASSWORD is required." .Values.api.config.ADMIN_PASSWORD | quote  }}
  ADMIN_NATS_USER: {{ required ".Values.api.config.ADMIN_NATS_USER is required." .Values.api.config.ADMIN_NATS_USER | quote  }}
  ADMIN_NATS_PASSWORD: {{ required ".Values.api.config.ADMIN_NATS_PASSWORD is required." .Values.api.config.ADMIN_NATS_PASSWORD | quote  }}

...
---
kind: "ConfigMap"
apiVersion: "v1"
metadata:
  name: {{ printf "%s-dispatcher" (include "common.names.fullname" .) }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
    {{- if .Values.additionalLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.additionalLabels "context" . ) | nindent 4 }}
    {{- end }}
  {{- if .Values.additionalAnnotations }}
  annotations: {{- include "common.tplvalues.render" ( dict "value" .Values.additionalAnnotations "context" . ) | nindent 4 }}
  {{- end }}
data:
  LOG_LEVEL: {{ required ".Values.dispatcher.config.LOG_LEVEL is required." .Values.dispatcher.config.LOG_LEVEL | quote  }}
  UDM_HOST: {{ .Values.dispatcher.config.UDM_HOST | default ( printf "%s-udm-rest-api" .Release.Name ) | quote  }}
  UDM_PORT: {{ required ".Values.dispatcher.config.UDM_PORT is required." .Values.dispatcher.config.UDM_PORT | quote  }}
  NATS_USER: {{ required ".Values.dispatcher.config.NATS_USER is required." .Values.dispatcher.config.NATS_USER | quote  }}
  NATS_PASSWORD: {{ required ".Values.dispatcher.config.NATS_PASSWORD is required." .Values.dispatcher.config.NATS_PASSWORD | quote  }}
...
---
kind: "ConfigMap"
apiVersion: "v1"
metadata:
  name: {{ printf "%s-prefill" (include "common.names.fullname" .) }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
    {{- if .Values.additionalLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.additionalLabels "context" . ) | nindent 4 }}
    {{- end }}
  {{- if .Values.additionalAnnotations }}
  annotations: {{- include "common.tplvalues.render" ( dict "value" .Values.additionalAnnotations "context" . ) | nindent 4 }}
  {{- end }}
data:
  LOG_LEVEL: {{ required ".Values.prefill.config.LOG_LEVEL is required." .Values.prefill.config.LOG_LEVEL | quote  }}
  UDM_HOST: {{ .Values.prefill.config.UDM_HOST | default ( printf "%s-udm-rest-api" .Release.Name ) | quote  }}
  UDM_PORT: {{ required ".Values.prefill.config.UDM_PORT is required." .Values.prefill.config.UDM_PORT | quote  }}
  UDM_USERNAME: {{ required ".Values.prefill.config.UDM_USERNAME is required." .Values.prefill.config.UDM_USERNAME | quote  }}
  UDM_PASSWORD: {{ required ".Values.prefill.config.UDM_PASSWORD is required." .Values.prefill.config.UDM_PASSWORD | quote  }}
  NATS_USER: {{ required ".Values.prefill.config.NATS_USER is required." .Values.prefill.config.NATS_USER | quote  }}
  NATS_PASSWORD: {{ required ".Values.prefill.config.NATS_PASSWORD is required." .Values.prefill.config.NATS_PASSWORD | quote  }}
...

